PROJECT( libopensync-plugin-syncml C )

SET( VERSION "0.38" )

SET( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake/modules" )
#SET( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_INSTALL_PREFIX}/share/opensync-1.0/cmake/modules/")

INCLUDE_DIRECTORIES( ${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR} )

CMAKE_MINIMUM_REQUIRED( VERSION 2.4.4 )

# find requirements
SET ( LIBSYNCML_MIN_VERSION "0.4.7" )
SET ( OPENSYNC_MIN_VERSION "0.37" )

FIND_PACKAGE( OpenSync REQUIRED )
FIND_PACKAGE( GLIB2 REQUIRED )
FIND_PACKAGE( LibXml2 REQUIRED )
# TODO - check whether LibSyncml supports obex and/or http
FIND_PACKAGE( LibSyncMl REQUIRED )

INCLUDE( OpenSyncInternal )

# Defaults
SET( ENABLE_OBEX TRUE CACHE BOOL "OBEX Transport" )

# TODO: port HTTP transport to latest API
#SET( ENABLE_HTTP TRUE CACHE BOOL "HTTP Transport" )
SET( ENABLE_HTTP FALSE CACHE BOOL "HTTP Transport" )

CONFIGURE_FILE("config.h.cmake" "config.h")

# add uninstall target
CONFIGURE_FILE(	"${CMAKE_SOURCE_DIR}/cmake/modules/cmake_uninstall.cmake.in" "${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake" IMMEDIATE @ONLY)

ADD_CUSTOM_TARGET(uninstall "${CMAKE_COMMAND}" -P "${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake")

INCLUDE( CTest )
ENABLE_TESTING()

ADD_SUBDIRECTORY( src )
ADD_SUBDIRECTORY( tests )

OPENSYNC_PACKAGE( ${PROJECT_NAME} ${VERSION} )

