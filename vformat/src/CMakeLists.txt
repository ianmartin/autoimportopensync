LINK_DIRECTORIES( ${OPENSYNC_LIBRARY_DIRS} ${GLIB2_LIBRARY_DIRS} )
INCLUDE_DIRECTORIES( ${OPENSYNC_INCLUDE_DIRS} ${GLIB2_INCLUDE_DIRS} )

IF ( BUILD_XMLFORMAT )
	LIST( APPEND xmlformat_SRCS xmlformat-common.c )
ENDIF ( BUILD_XMLFORMAT )

IF ( BUILD_CONTACT )
	OPENSYNC_FORMAT_ADD( vcard vcard.c )
	IF ( BUILD_XMLFORMAT )
		ADD_DEFINITIONS( -DBUILD_XMLFORMAT_VCARD )
		LIST( APPEND xmlformat_SRCS xmlformat-vcard.c )
	ENDIF ( BUILD_XMLFORMAT )
	TARGET_LINK_LIBRARIES( vcard ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
ENDIF ( BUILD_CONTACT)

IF ( BUILD_CALENDAR )
	OPENSYNC_FORMAT_ADD( vevent vevent.c )
	OPENSYNC_FORMAT_ADD( vtodo vtodo.c )
	OPENSYNC_FORMAT_ADD( vjournal vjournal.c )
	IF ( BUILD_XMLFORMAT )
		ADD_DEFINITIONS( -DBUILD_XMLFORMAT_VCALENDAR )
		LIST( APPEND xmlformat_SRCS xmlformat-vcalendar.c )
		LIST( APPEND xmlformat_SRCS xmlformat-vevent.c )
		LIST( APPEND xmlformat_SRCS xmlformat-recurrence.c )
		#LIST( APPEND xmlformat_SRCS xmlformat-vtodo.c )
	ENDIF ( BUILD_XMLFORMAT )
	TARGET_LINK_LIBRARIES( vevent ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
	TARGET_LINK_LIBRARIES( vtodo ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
	TARGET_LINK_LIBRARIES( vjournal ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
ENDIF ( BUILD_CALENDAR )

IF ( BUILD_NOTE )
	OPENSYNC_FORMAT_ADD( vnote vnote.c )
	IF ( BUILD_XMLFORMAT )
		ADD_DEFINITIONS( -DBUILD_XMLFORMAT_VNOTE )
		LIST( APPEND xmlformat_SRCS xmlformat-vnote.c )
	ENDIF ( BUILD_XMLFORMAT )
	TARGET_LINK_LIBRARIES( vnote ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
ENDIF ( BUILD_NOTE )

IF ( BUILD_XMLFORMAT )
	OPENSYNC_FORMAT_ADD( vformat-xmlformat ${xmlformat_SRCS} vformat.c vformat-xmlformat.c )
	TARGET_LINK_LIBRARIES( vformat-xmlformat ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} )
ENDIF ( BUILD_XMLFORMAT )	


###### INSTALL ################### 

IF ( BUILD_XMLFORMAT )
	OPENSYNC_FORMAT_INSTALL( vformat-xmlformat )
ENDIF ( BUILD_XMLFORMAT )

IF ( BUILD_CONTACT )
	OPENSYNC_FORMAT_INSTALL( vcard )
ENDIF ( BUILD_CONTACT )

IF ( BUILD_CALENDAR )
	OPENSYNC_FORMAT_INSTALL( vevent )
	OPENSYNC_FORMAT_INSTALL( vtodo )
	OPENSYNC_FORMAT_INSTALL( vjournal )
ENDIF ( BUILD_CALENDAR )

IF ( BUILD_NOTE )
	OPENSYNC_FORMAT_INSTALL( vnote )
ENDIF ( BUILD_NOTE )

