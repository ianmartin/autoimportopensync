Import('*')

formatenv = env.Copy()

formatenv.Append( CPPPATH = '.' )

# basic vformat plugins
contact = formatenv.SharedLibrary('contact', ['vcard.c'], LIBS = ['opensync'], LIBPATH = '$prefix/$libsuffix')
event = formatenv.SharedLibrary('event', ['vevent.c'], LIBS = ['opensync'], LIBPATH = '$prefix/$libsuffix')
note = formatenv.SharedLibrary('note', ['vnote.c'], LIBS = ['opensync'], LIBPATH = '$prefix/$libsuffix')
todo = formatenv.SharedLibrary('todo', ['vtodo.c'], LIBS = ['opensync'], LIBPATH = '$prefix/$libsuffix')

# vformat support library
vformat = env.build_shlib('vformat', ['vformat.c'], 
					"0.0.0", LIBS = ['opensync'], 
					LIBPATH = '$prefix/$libsuffix')

# common xmlformat libraries
xmlformatcommon = env.build_shlib('xmlformat-common', ['xmlformat-common.c'], 
					"0.0.0", LIBS = ['opensync', 'vformat'], 
					LIBPATH = ['.', '$prefix/$libsuffix'])
xmlformatvcalendar = env.build_shlib('xmlformat-vcalendar', ['xmlformat-vcalendar.c'], 
					"0.0.0", LIBS = ['xmlformat-common'], 
					LIBPATH = ['.', '$prefix/$libsuffix'])

# xmlformat plugins which convert from vformat to xmlformat and backwards
xmlformatvcard = formatenv.SharedLibrary('xmlformat-vcard', ['xmlformat-vcard.c'], LIBS = ['xmlformat-common'], LIBPATH = ['.', '$prefix/$libsuffix'])
xmlformatvevent = formatenv.SharedLibrary('xmlformat-vevent', ['xmlformat-vevent.c'], LIBS = ['xmlformat-vcalendar'], LIBPATH = ['.', '$prefix/$libsuffix'])
xmlformatvnote = formatenv.SharedLibrary('xmlformat-vnote', ['xmlformat-vnote.c'], LIBS = ['xmlformat-vcalendar'], LIBPATH = ['.', '$prefix/$libsuffix'])
###xmlformatvtodo = formatenv.SharedLibrary('xmlformat-vtodo', ['xmlformat-vtodo.c'], LIBS = ['xmlformat-vcalendar'], LIBPATH = ['.', '$prefix/$libsuffix'])

# install plugins
formatenv.Install(install_format, contact)
formatenv.Install(install_format, event)
formatenv.Install(install_format, note)
formatenv.Install(install_format, todo)
formatenv.Install(install_format, xmlformatvcard)
formatenv.Install(install_format, xmlformatvevent)
formatenv.Install(install_format, xmlformatvnote)
###formatenv.Install(install_format, xmlformatvtodo)

# install libs
env.install_shlib(install_lib, vformat)
env.install_shlib(install_lib, xmlformatcommon)
env.install_shlib(install_lib, xmlformatvcalendar)

env.Alias('install', install_prefix)
