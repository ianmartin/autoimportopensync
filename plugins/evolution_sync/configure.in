dnl Process this file with autoconf to produce a configure script.

AC_PREREQ(2.58)
AC_INIT(src/evolution_sync.c)
AM_INIT_AUTOMAKE(evo2-sync, 0.01)
AM_CONFIG_HEADER(config.h)

EVO_VER=`evolution --version | sed -e 's/.nome .volution //g'`
EVO_MAJVER=${EVO_VER:0:1}
EVO_MINVER=${EVO_VER:2:1}

pkg_modules="glib-2.0"
if (( EVO_MAJVER > 1 || ( EVO_MAJVER==1 && EVO_MINVER >= 4))); then
  pkg_modules="${pkgmodules} evolution-addressbook evolution-calendar"
else
  AC_MSG_ERROR(This version of the Evolution plugin does only work with Evolution >= 1.4. For evolution 2.0 use the evolution2_sync plugin)
fi
PKG_CHECK_MODULES(PACKAGE, [$pkg_modules])
AC_SUBST(PACKAGE_CFLAGS)
AC_SUBST(PACKAGE_LIBS)

PKG_CHECK_MODULES(PACKAGE, [$pkg_modules])
AC_SUBST(PACKAGE_CFLAGS)
AC_SUBST(PACKAGE_LIBS)

AC_ISC_POSIX
AC_PROG_CC
AM_PROG_CC_STDC
AC_HEADER_STDC
AC_DISABLE_STATIC
AC_PROG_LIBTOOL

OPENSYNC_CONFIGDIR=${datadir}/opensync
AC_SUBST(OPENSYNC_CONFIGDIR)

OPENSYNC_PLUGINDIR=${libdir}/opensync
AC_SUBST(OPENSYNC_PLUGINDIR)

OPENSYNC_FORMATSDIR=${libdir}/opensync/formats
AC_SUBST(OPENSYNC_FORMATSDIR)

AC_ARG_ENABLE(stress-test,               [  --enable-stress-test     enable support for stress testing],STRESS_TEST=1,STRESS_TEST=0)
if test "x${STRESS_TEST}" = "x1"; then
	AC_DEFINE(STRESS_TEST,1,[Stress Testing])
fi

AC_OUTPUT([
Makefile
src/Makefile
])

echo "================"
if test "x${STRESS_TEST}" = "x1"; then
	echo "Stress Tests are enabled."
else
	echo "Stress Tests are disabled."
fi
echo "================"
